

<!-- CSS Refactor: still need to account for Open Dataset styles -->
{{#unless session.isAuthenticated}}
  {{#full-page-notification}}
    <h3 class="u-mr3 u-mb2 u-tc-secondary">Search through <strong class="u-pl1 u-pr1 u-fs4">{{datasetsNumber}}</strong> human genomic datasets</h3>
    {{#link-to 'root' class='c-btn c-btn--primary c-btn--shadow' invokeAction=(action 'trackLinkEvent')}}
      Search now
    {{/link-to}}
  {{/full-page-notification}}
{{/unless}}

<div class="grid-wrapper grid-wrapper-stepped {{unless session.isAuthenticated 'u-pt5' ''}}">
  <div class="grid grid--no-gutter">
    <div class="grid__col grid__col--3-of-3">
      <div class="c-card c-card-detail-overflow {{unless session.isAuthenticated 'dataset-notification-margin' ''}}">
        {{#unless inEditMode}}
          <div class="grid grid--no-gutter u-full-height">

            <!-- dataset -->
            <div class="grid__col grid__col--7-of-12 u-pos-relative u-full-height">
              <!-- header -->
              <header class="c-card-header u-bc-off-white u-flex u-justify-end u-items-center u-px2">
                <div class="u-flex u-items-center">
                  {{follow-button subscribable=request.subscribableId model=request}}
                  <ul class="o-list-inline u-pl2 u-mb0">
                    {{action-favourite model=request class="u-mr2"}}
                    {{action-share
                      actionableId=request.id
                      actionableType='request'
                      shareUrl=requestUrl
                    }}
                  </ul>
                </div>
              </header>

              <!-- body -->
              <!-- TODO hack fix to stop text overflow on mobile. Needs redesigning. -->
              <div class="u-p2" style="max-height: 80%; overflow: scroll;">
                <!-- heading/description -->
                <div class="u-flex u-content-around">
                  <h2 class="u-fs2 u-fw-med u-tc-primary u-mb1 u-grow-1">{{request.title}}</h2>
                  {{#if canEdit}}
                    {{fa-icon 'pencil' size=1 class='u-tc-tertiary u-hv-tc-secondary  u-cursor-pointer' click=(action 'enterEditMode')}}
                  {{/if}}
                </div>
                {{#if request.description}}
                  <p class="u-markdown-formatting u-fs1">{{markdown-to-html markdown=request.description}}</p>
                {{/if}}


                <!-- tags -->
                <div class="u-pt2 u-pb1">
                  {{#each tags as |tag|}}
                    {{tag-item tag=tag}}
                  {{/each}}
                </div>
                {{#if session.isAuthenticated}}
                  <div class="u-pl3">
                    {{add-tag addTag=(action 'addTag')}}
                  </div>
                  <span class="u-fs0 u-tc-tertiary">Add tags to improve searching and browsing through data. <a {{action "toggleTagModal"}}>Learn more</a></span>
                {{/if}}
              </div>

              <!-- footer -->
              <div class="u-pos-absolute u-full-width u-pos-bottom0 u-bc-white u-p2 u-border-top">

                {{#unless session.isAuthenticated}}
                  {{create-account-call-to-action}}
                {{/unless}}
                <ul class="o-list-flush-left u-mb0">
                  {{#if request.userId}}
                    <li class="u-fs0 u-tc-tertiary">Submitted by: {{#link-to 'user' request.usesId.id class="u-tc-secondary" }}<span class="u-fw-med u-fs1 u-tc-secondary">{{request.userId.displayName}}</span>{{/link-to}}</li>
                  {{/if}}
                  {{#if request.createdAt}}
                    <li class="u-fs0 u-tc-tertiary">Requested on: <span class="u-fw-med u-fs1 u-tc-secondary">{{moment-format request.createdAt}}</span></li>
                  {{/if}}
                </ul>
              </div>
            </div>

            <!-- Discussion  -->
            <div class="grid__col grid__col--5-of-12 u-full-height">
              <div class="u-border-left u-full-min-height">

                <!-- header -->
                <header class="c-card-header u-bc-off-white u-px2 u-flex u-items-center u-justify-center">
                  <h4 class="u-mb0 u-fs2 u-fw-med u-tc-primary">Discussions</h4>
                </header>

                <!-- body -->
                <div class="u-p2">
                  {{partial "datasets/tab-comments"}}
                </div>

              </div>
            </div>
          </div>
        {{else}}
          <header class="c-card-header u-bc-grey t-dark u-flex u-justify-center u-items-center u-px2 u-mb2">
            {{fa-icon 'pencil' size=1 class="u-mr2 u-tc-primary"}}
            <span class="u-tc-primary u-td-uppercase">Edit Request</span>
          </header>
          <div class="grid grid--no-gutter">
            <div class="grid__col grid__col--8-of-12 grid__col--push-2-of-12">
              <form class="u-px2">
                {{validated-input
                  label="Title"
                  type="text"
                  value=title
                  submit=(action 'save')
                  errors=validations.attrs.title.messages
                }}
                {{validated-input
                  label="Description"
                  type="textarea"
                  value=description
                  noMarkdown=true
                  submit=(action 'save')
                  errors=validations.attrs.description.messages
                }}
                <div class="u-flex u-justify-center u-items-center u-pt4">
                  {{async-button
                    action=(action 'save')
                    class="c-btn c-btn-primary u-px3 u-py1 u-mr2 u-td-uppercase"
                    default="Save Changes"
                    pending="Saving..."
                    disableWhen=(not validations.isValid)
                  }}
                  <button class="c-btn c-btn-text-secondary" {{action 'cancelEditMode'}}>Cancel</button>
                </div>
              </form>
            </div>
          </div>
        {{/unless}}
      </div>
    </div>
  </div>
</div>

<!-- CSS Refactor: still need to style modals -->
{{#if isShowingTagModal}}
  {{tag-modal action="toggleTagModal"}}
{{/if}}
