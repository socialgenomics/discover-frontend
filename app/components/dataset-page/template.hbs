{{#unless inEditMode}}
  <div class="grid grid--no-gutter u-full-height">

    <!-- dataset -->
    <div class="grid__col grid__col--7-of-12 u-pos-relative u-full-height">
      <!-- header -->
      <header class="c-card-header u-bc-off-white u-flex {{if assaysToDisplay 'u-justify-between' 'u-justify-end'}} u-items-center u-px2">
        {{#if assaysToDisplay}}
          {{assay-list assays=assaysToDisplay}}
        {{/if}}
        <div class="u-pl1 u-flex u-items-center">
          {{follow-button subscribable=model.subscribableId model=model}}
          <ul class="u-flex o-list-flush-left u-pl2 u-mb0">
            {{action-favourite model=model class="u-mr2"}}
            {{action-share
              actionableId=model.id
              actionableType=modelName
              shareUrl=modelUrl
            }}
          </ul>
        </div>
      </header>

      <!-- body -->
      <!-- TODO hack fix to stop text overflow on mobile. Needs redesigning. -->
      <div class="u-p2" style="max-height: 70%; overflow: scroll;">
        <!-- heading/description -->
        <div class="u-flex u-content-around">
          <h2 class="u-fs2 u-fw-med u-tc-primary u-mb1 u-grow-1 u-hyphens-auto">{{model.title}}</h2>
          {{#if canEdit}}
            {{fa-icon 'pencil' class='u-tc-tertiary u-hv-tc-secondary u-cursor-pointer u-fs2'
                click=(action 'enterEditMode')}}
          {{/if}}
        </div>
        {{#if model.description}}
          <p class="u-markdown-formatting u-fs1">{{markdown-to-html markdown=model.description extensions='targetBlankLinks sanitize'}}</p>
        {{/if}}
        <!-- tags -->
        <div class="u-pt2 u-pb1">
          {{#each tags as |tag|}}
            {{tag-item tag=tag}}
          {{/each}}
        </div>
        {{#if session.isAuthenticated}}
          <div class="u-pl3">
            {{add-tag addTag=(action 'addTag')}}
          </div>
          <span class="u-fs0 u-tc-tertiary">
            Add tags to improve searching and browsing through data. {{#link-to 'help.other'}}Learn more{{/link-to}}
          </span>
        {{/if}}
      </div>

      <!-- footer -->
      <div class="u-pos-absolute u-full-width u-pos-bottom0 u-bc-white u-p2 u-border-top">

        {{#unless session.isAuthenticated}}
          {{create-account-call-to-action}}
        {{/unless}}

        <ul class="o-list-flush-left u-mb2">
          {{#if model.userId}}
            <li class="u-fs0 u-tc-tertiary">
              Submitted by:
              {{#link-to 'user' model.userId.id }}
                <span class="u-fw-med u-fs1 u-tc-secondary">{{model.userId.displayName}}</span>
              {{/link-to}}
            </li>
          {{else}}
            {{#if model.datasourceId.name}}
              <li class="u-fs0 u-tc-tertiary">
                Sourced from:
                {{#link-to 'datasources.source' model.datasourceId.id}}
                  <span class="u-fw-med u-fs1 u-tc-secondary">{{model.datasourceId.name}}</span>
                {{/link-to}}
              </li>
            {{/if}}

            {{!-- TODO: should we remove this? I don't see this property in a model --}}
            {{#if model.accession}}
              <li class="u-fs0 u-tc-tertiary">
                Accession ID: <span class="u-fw-med u-fs1 u-tc-secondary">{{model.externalId}}</span>
              </li>
            {{/if}}
          {{/if}}

          {{#if (and isRequest model.createdAt )}}
            <li class="u-fs0 u-tc-tertiary">
              Requested on:
              <span class="u-fw-med u-fs1 u-tc-secondary">{{moment-format model.createdAt}}</span>
            </li>
          {{/if}}

          {{#if model.access}}
            <li class="u-fs0 u-tc-tertiary">
              Access type:
              {{#link-to 'help.searching-for-data' (query-params help="filters")}}
                <span class="u-fw-med u-fs1 u-tc-secondary">{{model.access}}</span>
              {{/link-to}}
            </li>
          {{/if}}
        </ul>

        {{#if model.url}}
          <a
            target="_blank"
            href="{{if session.isAuthenticated model.url ''}}"
            class="c-btn c-btn-primary"
            {{action "trackExit"}}
          >
            {{#if (eq model.access 'Open')}}Access Data{{else}}Go To Dataset{{/if}}
          </a>
        {{/if}}
      </div>
    </div>

    <!-- Attributes / Discussion  -->
    <div class="c-card-detail-discussion grid__col grid__col--5-of-12 u-full-height">
      <div class="u-border-left u-full-min-height">
        {{#unless isRequest}}
          {{#tab-list class='u-mb2'}}
            {{tab-list-action-item
                setActiveTab=(action 'setActiveTab')
                activeTab=activeTab
                tabName='metadata'}}
            {{tab-list-action-item
                setActiveTab=(action 'setActiveTab')
                activeTab=activeTab
                tabName='discussion'}}
          {{/tab-list}}
          <div class="u-p2">
            {{#if (eq activeTab 'metadata')}}
              {{partial "datasets/tab-metadata"}}
            {{else}}
              {{partial "datasets/tab-comments"}}
            {{/if}}
          </div>
        {{else}}
          <!-- Discussions header -->
          <header class="c-card-header u-bc-off-white u-px2 u-flex u-items-center u-justify-center">
            <h4 class="u-mb0 u-fs2 u-fw-med u-tc-primary">Discussions</h4>
          </header>

          <!-- Discussions body -->
          <div class="u-p2">
            {{partial "datasets/tab-comments"}}
          </div>
        {{/unless}}
      </div>
    </div>
  </div>
{{else}}
  <header class="c-card-header u-bc-grey t-dark u-flex u-justify-center u-items-center u-px2 u-mb2">
    {{fa-icon 'pencil' class="u-mr2 u-tc-primary u-fs2"}}
    <span class="u-tc-primary u-fw-med u-fs2">Edit {{capitalize modelName}}</span>
  </header>
  <div class="grid grid--no-gutter">
    <div class="grid__col grid__col--8-of-12 grid__col--push-2-of-12">
      <form class="u-px2">
        {{#each editableProperties as |prop|}}
          {{validated-input
            label=(capitalize prop.key)
            value=(mut (get this prop.key))
            errors=(v-get this prop.key 'messages')
            type=(if prop.multiline 'textarea' 'text')
            noMarkdown=true
          }}
        {{/each}}
        <div class="u-flex u-justify-center">
          {{async-button
            action=(action 'save')
            class="c-btn c-btn-primary u-mr2"
            default="Save Changes"
            pending="Saving..."
            disableWhen=(not validations.isValid)
          }}
          <button class="c-btn c-btn-text-secondary" {{action 'cancelEditMode'}}>Cancel</button>
        </div>
      </form>
    </div>
  </div>
{{/unless}}
